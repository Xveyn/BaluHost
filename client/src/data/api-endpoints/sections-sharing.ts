import { createElement } from 'react';
import { Share2, Database, RefreshCw, GitBranch } from 'lucide-react';
import type { ApiSection } from './types';

const icon = (Icon: React.ComponentType<{ className?: string }>) =>
  createElement(Icon, { className: 'w-5 h-5' });

export const sharingSections: ApiSection[] = [
  {
    title: 'Shares',
    icon: icon(Share2),
    endpoints: [
      {
        method: 'POST',
        path: '/api/shares/links',
        description: 'Create Public Share Link',
        requiresAuth: true,
        body: [
          { field: 'file_id', type: 'integer', required: true, description: 'File ID to share' },
          { field: 'password', type: 'string', required: false, description: 'Optional password protection' },
          { field: 'expires_at', type: 'datetime', required: false, description: 'Expiration date' },
          { field: 'max_downloads', type: 'integer', required: false, description: 'Max download limit' },
          { field: 'allow_download', type: 'boolean', required: false, description: 'Allow downloads' },
          { field: 'allow_preview', type: 'boolean', required: false, description: 'Allow preview' },
        ],
        response: `{
  "id": 1,
  "token": "abc123xyz",
  "file_id": 5,
  "has_password": true,
  "allow_download": true,
  "expires_at": "2025-12-31T23:59:59",
  "created_at": "2025-11-23T10:30:00"
}`,
      },
      {
        method: 'GET',
        path: '/api/shares/links',
        description: 'List My Share Links',
        requiresAuth: true,
        params: [{ name: 'include_expired', type: 'boolean', required: false, description: 'Include expired links' }],
        response: '[{ "id": 1, "token": "abc123", "file_name": "document.pdf", "download_count": 5 }]',
      },
      {
        method: 'GET',
        path: '/api/shares/links/{link_id}',
        description: 'Get Share Link Detail',
        requiresAuth: true,
        params: [{ name: 'link_id', type: 'integer', required: true, description: 'Share link ID' }],
        response: '{ "id": 1, "token": "abc123", "file_name": "document.pdf", "download_count": 5 }',
      },
      {
        method: 'PATCH',
        path: '/api/shares/links/{link_id}',
        description: 'Update Share Link',
        requiresAuth: true,
        params: [{ name: 'link_id', type: 'integer', required: true, description: 'Share link ID' }],
        body: [
          { field: 'max_downloads', type: 'integer', required: false, description: 'New max downloads' },
          { field: 'expires_at', type: 'datetime', required: false, description: 'New expiration' },
        ],
        response: '{ "id": 1, "token": "abc123", "max_downloads": 20 }',
      },
      {
        method: 'DELETE',
        path: '/api/shares/links/{link_id}',
        description: 'Delete Share Link',
        requiresAuth: true,
        params: [{ name: 'link_id', type: 'integer', required: true, description: 'Share link ID' }],
        response: '204 No Content',
      },
      {
        method: 'POST',
        path: '/api/shares/public/{token}/access',
        description: 'Access Public Share',
        requiresAuth: false,
        params: [{ name: 'token', type: 'string', required: true, description: 'Share token' }],
        body: [{ field: 'password', type: 'string', required: false, description: 'Share password if required' }],
        response: 'Binary file content or file info',
      },
      {
        method: 'GET',
        path: '/api/shares/public/{token}/info',
        description: 'Get Public Share Info (No Auth)',
        requiresAuth: false,
        params: [{ name: 'token', type: 'string', required: true, description: 'Share token from URL' }],
        response: '{ "has_password": true, "is_accessible": true, "file_name": "document.pdf", "file_size": 1048576 }',
      },
      {
        method: 'POST',
        path: '/api/shares/user-shares',
        description: 'Share File With User',
        requiresAuth: true,
        body: [
          { field: 'file_id', type: 'integer', required: true, description: 'File ID' },
          { field: 'shared_with_user_id', type: 'integer', required: true, description: 'Target user ID' },
          { field: 'can_read', type: 'boolean', required: false, description: 'Read permission (default: true)' },
          { field: 'can_write', type: 'boolean', required: false, description: 'Write permission' },
          { field: 'can_delete', type: 'boolean', required: false, description: 'Delete permission' },
        ],
        response: '{ "id": 1, "file_id": 5, "shared_with_username": "colleague", "can_read": true }',
      },
      { method: 'GET', path: '/api/shares/user-shares', description: 'List My User Shares', requiresAuth: true, response: '[{ "id": 1, "file_id": 5, "shared_with_username": "colleague" }]' },
      {
        method: 'GET',
        path: '/api/shares/user-shares/file/{file_id}',
        description: 'Get Shares for File',
        requiresAuth: true,
        params: [{ name: 'file_id', type: 'integer', required: true, description: 'File ID' }],
        response: '[{ "id": 1, "shared_with_username": "colleague", "can_read": true }]',
      },
      { method: 'GET', path: '/api/shares/shared-with-me', description: 'Get Files Shared With Me', requiresAuth: true, response: '[{ "share_id": 1, "file_name": "report.pdf", "owner_username": "boss" }]' },
      {
        method: 'PATCH',
        path: '/api/shares/user-shares/{share_id}',
        description: 'Update User Share Permissions',
        requiresAuth: true,
        params: [{ name: 'share_id', type: 'integer', required: true, description: 'Share ID' }],
        body: [
          { field: 'can_write', type: 'boolean', required: false, description: 'Write permission' },
          { field: 'can_delete', type: 'boolean', required: false, description: 'Delete permission' },
        ],
        response: '{ "id": 1, "can_write": true, "can_delete": false }',
      },
      {
        method: 'DELETE',
        path: '/api/shares/user-shares/{share_id}',
        description: 'Remove User Share',
        requiresAuth: true,
        params: [{ name: 'share_id', type: 'integer', required: true, description: 'Share ID' }],
        response: '204 No Content',
      },
      { method: 'GET', path: '/api/shares/statistics', description: 'Get Share Statistics', requiresAuth: true, response: '{ "total_links": 12, "total_shares": 5, "total_downloads": 150 }' },
    ],
  },
  {
    title: 'Backup',
    icon: icon(Database),
    endpoints: [
      {
        method: 'POST',
        path: '/api/backups/',
        description: 'Create Backup (Admin)',
        requiresAuth: true,
        body: [
          { field: 'includes_database', type: 'boolean', required: false, description: 'Include database (default: true)' },
          { field: 'includes_files', type: 'boolean', required: false, description: 'Include files (default: true)' },
          { field: 'includes_config', type: 'boolean', required: false, description: 'Include config (default: true)' },
          { field: 'description', type: 'string', required: false, description: 'Backup description' },
        ],
        response: '{ "id": 1, "filename": "backup_20251123.tar.gz", "size_bytes": 524288000, "created_at": "2025-11-23T10:30:00" }',
      },
      { method: 'GET', path: '/api/backups/', description: 'List Backups (Admin)', requiresAuth: true, response: '{ "backups": [...], "total_size_bytes": 524288000 }' },
      {
        method: 'GET',
        path: '/api/backups/{backup_id}',
        description: 'Get Backup Detail (Admin)',
        requiresAuth: true,
        params: [{ name: 'backup_id', type: 'integer', required: true, description: 'Backup ID' }],
        response: '{ "id": 1, "filename": "backup_20251123.tar.gz", "size_bytes": 524288000 }',
      },
      {
        method: 'POST',
        path: '/api/backups/{backup_id}/restore',
        description: 'Restore Backup (Admin)',
        requiresAuth: true,
        params: [{ name: 'backup_id', type: 'integer', required: true, description: 'Backup ID' }],
        body: [
          { field: 'confirm', type: 'boolean', required: true, description: 'Must be true to proceed' },
          { field: 'restore_database', type: 'boolean', required: false, description: 'Restore database' },
          { field: 'restore_files', type: 'boolean', required: false, description: 'Restore files' },
        ],
        response: '{ "success": true, "message": "Backup restored successfully" }',
      },
      {
        method: 'GET',
        path: '/api/backups/{backup_id}/download',
        description: 'Download Backup File (Admin)',
        requiresAuth: true,
        params: [{ name: 'backup_id', type: 'integer', required: true, description: 'Backup ID' }],
        response: 'Binary tar.gz file',
      },
      {
        method: 'DELETE',
        path: '/api/backups/{backup_id}',
        description: 'Delete Backup (Admin)',
        requiresAuth: true,
        params: [{ name: 'backup_id', type: 'integer', required: true, description: 'Backup ID' }],
        response: '204 No Content',
      },
    ],
  },
  {
    title: 'Sync',
    icon: icon(RefreshCw),
    endpoints: [
      {
        method: 'POST',
        path: '/api/sync/register',
        description: 'Register Sync Client',
        requiresAuth: true,
        body: [
          { field: 'device_name', type: 'string', required: true, description: 'Client device name' },
          { field: 'device_type', type: 'string', required: false, description: 'Device type' },
        ],
        response: '{ "device_id": "uuid-1234", "sync_token": "..." }',
      },
      {
        method: 'POST',
        path: '/api/sync/register-desktop',
        description: 'Register Desktop Sync Client',
        requiresAuth: true,
        body: [
          { field: 'device_name', type: 'string', required: true, description: 'Desktop name' },
          { field: 'os', type: 'string', required: false, description: 'Operating system' },
        ],
        response: '{ "device_id": "uuid-1234", "sync_token": "..." }',
      },
      {
        method: 'GET',
        path: '/api/sync/status/{device_id}',
        description: 'Get Sync Status',
        requiresAuth: true,
        params: [{ name: 'device_id', type: 'string', required: true, description: 'Device ID' }],
        response: '{ "status": "synced", "last_sync": "2025-11-23T10:30:00" }',
      },
      { method: 'POST', path: '/api/sync/changes', description: 'Push Changes', requiresAuth: true, response: '{ "accepted": 5, "conflicts": 0 }' },
      {
        method: 'POST',
        path: '/api/sync/conflicts/{file_path}/resolve',
        description: 'Resolve Sync Conflict',
        requiresAuth: true,
        params: [{ name: 'file_path', type: 'string', required: true, description: 'Conflicted file path' }],
        response: '{ "resolved": true }',
      },
      {
        method: 'GET',
        path: '/api/sync/history/{file_path}',
        description: 'Get File Sync History',
        requiresAuth: true,
        params: [{ name: 'file_path', type: 'string', required: true, description: 'File path' }],
        response: '{ "versions": [...] }',
      },
      { method: 'GET', path: '/api/sync/state', description: 'Get Sync State', requiresAuth: true, response: '{ "state": "idle" }' },
      { method: 'POST', path: '/api/sync/upload/start', description: 'Start Chunked Sync Upload', requiresAuth: true, response: '{ "upload_id": "..." }' },
      { method: 'POST', path: '/api/sync/upload/{upload_id}/chunk/{chunk_number}', description: 'Upload Sync Chunk', requiresAuth: true, response: '{ "received": true }' },
      { method: 'GET', path: '/api/sync/upload/{upload_id}/progress', description: 'Get Sync Upload Progress', requiresAuth: true, response: '{ "chunks_received": 5, "total_chunks": 10 }' },
      { method: 'POST', path: '/api/sync/upload/{upload_id}/resume', description: 'Resume Sync Upload', requiresAuth: true, response: '{ "next_chunk": 6 }' },
      { method: 'DELETE', path: '/api/sync/upload/{upload_id}', description: 'Cancel Sync Upload', requiresAuth: true, response: '204 No Content' },
      { method: 'POST', path: '/api/sync/bandwidth/limit', description: 'Set Bandwidth Limit', requiresAuth: true, body: [{ field: 'limit_kbps', type: 'integer', required: true, description: 'Limit in kbps (0 = unlimited)' }], response: '{ "limit_kbps": 5000 }' },
      { method: 'GET', path: '/api/sync/bandwidth/limit', description: 'Get Bandwidth Limit', requiresAuth: true, response: '{ "limit_kbps": 5000 }' },
      { method: 'POST', path: '/api/sync/schedule/create', description: 'Create Sync Schedule', requiresAuth: true, response: '{ "id": 1, "cron": "0 */6 * * *" }' },
      { method: 'GET', path: '/api/sync/schedule/list', description: 'List Sync Schedules', requiresAuth: true, response: '[{ "id": 1, "cron": "0 */6 * * *" }]' },
      { method: 'POST', path: '/api/sync/schedule/{schedule_id}/disable', description: 'Disable Sync Schedule', requiresAuth: true, response: '{ "disabled": true }' },
      { method: 'PUT', path: '/api/sync/schedule/{schedule_id}', description: 'Update Sync Schedule', requiresAuth: true, response: '{ "id": 1, "updated": true }' },
      { method: 'POST', path: '/api/sync/selective/configure', description: 'Configure Selective Sync', requiresAuth: true, response: '{ "configured": true }' },
      { method: 'GET', path: '/api/sync/selective/list/{device_id}', description: 'List Selective Sync Folders', requiresAuth: true, response: '[{ "path": "/Documents", "enabled": true }]' },
      { method: 'POST', path: '/api/sync/devices', description: 'Register Device (Compat)', requiresAuth: true, response: '{ "device_id": "..." }' },
      { method: 'GET', path: '/api/sync/devices', description: 'List Devices (Compat)', requiresAuth: true, response: '[{ "device_id": "...", "name": "Desktop" }]' },
    ],
  },
  {
    title: 'Version Control (VCL)',
    icon: icon(GitBranch),
    endpoints: [
      {
        method: 'GET',
        path: '/api/vcl/versions/{file_id}',
        description: 'Get File Versions',
        requiresAuth: true,
        params: [{ name: 'file_id', type: 'integer', required: true, description: 'File ID' }],
        response: '{ "versions": [{ "version": 1, "size": 1024, "created_at": "..." }] }',
      },
      {
        method: 'POST',
        path: '/api/vcl/restore',
        description: 'Restore File Version',
        requiresAuth: true,
        body: [
          { field: 'file_id', type: 'integer', required: true, description: 'File ID' },
          { field: 'version', type: 'integer', required: true, description: 'Version number' },
        ],
        response: '{ "restored": true, "version": 2 }',
      },
      { method: 'GET', path: '/api/vcl/versions/diff', description: 'Get Version Diff', requiresAuth: true, params: [{ name: 'file_id', type: 'integer', required: true, description: 'File ID' }, { name: 'v1', type: 'integer', required: true, description: 'Version A' }, { name: 'v2', type: 'integer', required: true, description: 'Version B' }], response: '{ "diff": "..." }' },
      { method: 'GET', path: '/api/vcl/quota', description: 'Get VCL Quota', requiresAuth: true, response: '{ "used_bytes": 1048576, "max_bytes": 10485760 }' },
      { method: 'GET', path: '/api/vcl/settings', description: 'Get VCL Settings', requiresAuth: true, response: '{ "max_versions": 50, "auto_cleanup": true }' },
      { method: 'PUT', path: '/api/vcl/settings', description: 'Update VCL Settings', requiresAuth: true, response: '{ "max_versions": 100, "auto_cleanup": true }' },
      { method: 'GET', path: '/api/vcl/admin/overview', description: 'Admin VCL Overview', requiresAuth: true, response: '{ "total_versions": 500, "total_size": 52428800 }' },
      { method: 'GET', path: '/api/vcl/admin/users', description: 'Admin VCL Users', requiresAuth: true, response: '[{ "user_id": 1, "version_count": 50 }]' },
      { method: 'GET', path: '/api/vcl/admin/stats', description: 'Admin VCL Statistics', requiresAuth: true, response: '{ "total_versions": 500, "storage_used": 52428800 }' },
      { method: 'PUT', path: '/api/vcl/admin/settings/{user_id}', description: 'Admin Update User VCL Settings', requiresAuth: true, params: [{ name: 'user_id', type: 'integer', required: true, description: 'User ID' }], response: '{ "max_versions": 100 }' },
      { method: 'POST', path: '/api/vcl/admin/cleanup', description: 'Admin VCL Cleanup', requiresAuth: true, response: '{ "deleted_versions": 25, "freed_bytes": 10485760 }' },
    ],
  },
];
