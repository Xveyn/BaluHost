# ===================================
# SSL/TLS Best Practices Configuration
# ===================================
# Based on Mozilla SSL Configuration Generator (Intermediate)
# Compatible with: Firefox 27+, Chrome 30+, IE 11+, Edge, Opera 17+, Safari 9+, Android 5.0+, Java 8+
# Generated: 2026-01-13
# Reference: https://ssl-config.mozilla.org/
# ===================================

# SSL Protocols
# TLSv1.2 and TLSv1.3 only (no SSLv3, TLSv1, TLSv1.1)
ssl_protocols TLSv1.2 TLSv1.3;

# Cipher Suites (Intermediate Profile)
# Prioritizes forward secrecy (ECDHE) and modern ciphers (AES-GCM, ChaCha20-Poly1305)
ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';

# Server cipher preference
ssl_prefer_server_ciphers off;

# Diffie-Hellman Parameters (for DHE cipher suites)
# Generate with: openssl dhparam -out /etc/nginx/dhparam.pem 2048
ssl_dhparam /etc/nginx/dhparam.pem;

# Session Cache (improves performance by reusing SSL sessions)
ssl_session_cache shared:SSL:10m;
ssl_session_timeout 1d;
ssl_session_tickets off;

# OCSP Stapling (improves SSL handshake performance and privacy)
# Enables online certificate status verification without client contacting CA
ssl_stapling on;
ssl_stapling_verify on;

# DNS Resolver for OCSP (use your preferred DNS)
# Google DNS: 8.8.8.8 8.8.4.4
# Cloudflare DNS: 1.1.1.1 1.0.0.1
resolver 8.8.8.8 8.8.4.4 valid=300s;
resolver_timeout 5s;

# OCSP Response Cache
ssl_stapling_file /var/cache/nginx/ocsp_cache.der;

# ===================================
# Security Headers (HTTPS-specific)
# ===================================

# HTTP Strict Transport Security (HSTS)
# Forces browsers to use HTTPS for 1 year
# includeSubDomains: applies to all subdomains
# preload: allows inclusion in browser HSTS preload lists
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# ===================================
# Additional SSL Performance Optimizations
# ===================================

# Early Data (TLS 1.3 0-RTT)
# Improves performance but introduces replay attack risk
# Only enable if your application is idempotent for GET requests
# ssl_early_data on;

# Buffer Size Optimization
ssl_buffer_size 4k;

# ===================================
# Notes
# ===================================
# 1. Generate dhparam.pem before using this config:
#    openssl dhparam -out /etc/nginx/dhparam.pem 2048
#
# 2. Test SSL configuration:
#    https://www.ssllabs.com/ssltest/
#    Target grade: A or A+
#
# 3. Update this configuration periodically as cryptographic standards evolve
#
# 4. For maximum security (at cost of compatibility), use Mozilla "Modern" profile:
#    ssl_protocols TLSv1.3;
#    (no cipher configuration needed for TLSv1.3)
#
# 5. Monitor for new vulnerabilities and update accordingly
